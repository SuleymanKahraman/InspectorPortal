<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard - NiceAdmin Bootstrap Template</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: Mar 09 2023 with Bootstrap v5.2.3
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
    input[type="file"] {
      display: none;
    }

    .custom-file-upload {
      display: inline-block;
      padding: 6px 12px;
      cursor: pointer;
      color: blue;
    }
  </style>
</head>

<body>
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Uyarı!</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Silmek istediğinize emin misiniz?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
          <button type="button" class="btn btn-danger" onclick="deleteMufettis()">Evet</button>
        </div>
      </div>
    </div>
  </div>
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-center">
      <a href="anasayfa.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">Teftiş Modül Admin</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->
    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Ara" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> <!--End Search Bar -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="anasayfa.html">
          <i class="bi bi-grid"></i>
          <span>Ana Sayfa</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link " href="mufettisTanimla.html">
          <i class="bi bi-person-circle"></i>
          <span>Müfettiş Tanımlama</span>
        </a>
      </li>
      <li class="nav-item" style="display: none;">
        <a class="nav-link " href="mufettisBilgileri.html">
          <i class="bi bi-person-circle"></i>
          <span>Müfettiş Bilgileri</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="uniteTanimla.html">
          <i class="bi bi-person-circle"></i>
          <span>Ünite Tanımlama</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Görevler</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="periyodikteftis.html">
              <i class="bi bi-circle"></i><span>Periyodik Teftiş</span>
            </a>
          </li>
          <li>
            <a href="inceleme.html">
              <i class="bi bi-circle"></i><span>İnceleme</span>
            </a>
          </li>
          <li>
            <a href="sorusturma.html">
              <i class="bi bi-circle"></i><span>Soruşturma</span>
            </a>
          </li>
        </ul>
      </li><!-- End Components Nav -->
  </aside><!-- End Sidebar-->


  <main id="main" class="main">

    <section class="section profile">
      <div class="row">
        <div class="col-xl-4">

          <div class="card">
            <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">

              <img src="assets/img/noimage.png" alt="Profile" class="rounded-circle" id="profile-photo">
              <h2><span id="isim">Süleyman</span> <span id="soyisim">Kahraman</span></h2>
              <h3><span id="unvan">Müfettiş Yardımcısı</span></h3>
              <h5>Kurum Sicil No: <span id="sicilNo">6371</span></h5>
              <h6>Müfettiş No: <span id="mufettisNo">30</span></h6>
              <div class="social-links mt-2">
                <!-- <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a> -->
              </div>
            </div>
          </div>

        </div>

        <div class="col-xl-8">

          <div class="card">
            <div class="card-body pt-3">
              <!-- Bordered Tabs -->
              <div class="d-flex justify-content-between align-items-center">
                <ul class="nav nav-tabs nav-tabs-bordered d-flex jus">

                  <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab"
                      data-bs-target="#profile-overview">Hakkında</button>
                  </li>

                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-edit">Güncelle</button>
                  </li>



                  <!-- <li class="nav-item">
                                  <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-change-password">Change
                                    Password</button>
                                </li> -->

                </ul>
                <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal"
                  type="button"><i class="bi bi-trash"></i></button>
              </div>

              <div class="tab-content pt-2">

                <div class="tab-pane fade show active profile-overview" id="profile-overview">
                  <!-- <h5 class="card-title">About</h5>
                  <p class="small fst-italic">Sunt est soluta temporibus accusantium neque nam maiores cumque
                    temporibus. Tempora libero non est unde veniam est qui dolor. Ut sunt iure rerum quae quisquam autem
                    eveniet perspiciatis odit. Fuga sequi sed ea saepe at unde.</p>

                  <h5 class="card-title">Profile Details</h5> -->
                  <div class="row">
                    <div class="col-lg-3 col-md-4 label">TcNo</div>
                    <div class="col-lg-9 col-md-8"><span id="tcNo"></span> </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-3 col-md-4 label">Email Adresi</div>
                    <div class="col-lg-9 col-md-8"><Span id="emailAdress"></Span></div>
                  </div>
                  <div class="row">
                    <div class="col-lg-3 col-md-4 label">Çalışma Durumu</div>
                    <div class="col-lg-9 col-md-8"><Span id="calismaDurumu"></Span></div>
                  </div>
                  <div class="row">
                    <div class="col-lg-3 col-md-4 label">Telefon</div>
                    <div class="col-lg-9 col-md-8"><span id="telefon"></span></div>
                  </div>
                  <div class="row">
                    <div class="col-lg-3 col-md-4 label">Adres</div>
                    <div class="col-lg-9 col-md-8"><span id="adres"></span></div>
                  </div>
                </div>

                <div class="tab-pane fade profile-edit pt-3" id="profile-edit">
                  <!-- Profile Edit Form -->
                  <form id="guncelle-form" action="mufettisBilgileri.html">
                    <div class="profile-card d-flex flex-column align-items-center">
                      <img src="assets/img/noimage.png" id="profile-photo-guncelle" alt="Profile"
                        class="rounded-circle">
                      <div class="pt-2">
                        <label class="custom-file-upload">
                          <i class="bi bi-upload"></i>
                          <span>Fotoğraf Yükle</span>
                          <input type="file" id="avatar" name="avatar" style="width: 200px;" class="mt-3"
                            accept="image/png, image/jpeg" onchange="onUploadPhoto(event)">
                        </label>
                      </div>
                    </div>
                    <br>
                    <!-- Vertical Form -->
                    <div class="col-12">
                      <label class="form-label">İsim</label>
                      <input type="text" class="form-control" id="g-isim">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Soy İsim</label>
                      <input type="text" class="form-control" id="g-soyisim">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Email Adresi</label>
                      <input type="email" class="form-control" id="g-email">
                    </div>
                    <div class="col-12">
                      <label class="form-label">TC No</label>
                      <input type="number" class="form-control" id="g-tcNo">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Kurum Sicil No</label>
                      <input type="number" class="form-control" id="g-kurumSicilNo">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Müfettiş No</label>
                      <input type="number" class="form-control" id="g-mufettisNo">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Unvan</label>
                      <select id="g-unvan" class="form-select">
                        <option>Müfettiş Yardımcısı</option>
                        <option>Müfettiş</option>
                        <option>Başmüfettiş</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Çalışma Durumu</label>
                      <select id="g-calismaDurumu" class="form-select">
                        <option>Aktif</option>
                        <option>Pasif</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">Telefon</label>
                      <input type="number" class="form-control" id="g-telefon">
                    </div>
                    <div class="col-12">
                      <label class="form-label">Adres</label>
                      <input type="text" class="form-control" id="g-adres">
                    </div>
                    <br>
                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">Değişiklikleri
                        Kaydet</button>
                    </div>
                  </form><!-- End Profile Edit Form -->

                </div>

                <div class="tab-pane fade pt-3" id="profile-settings">

                  <!-- Settings Form -->
                  <form>

                    <div class="row mb-3">
                      <label for="fullName" class="col-md-4 col-lg-3 col-form-label">Email Notifications</label>
                      <div class="col-md-8 col-lg-9">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="changesMade" checked>
                          <label class="form-check-label" for="changesMade">
                            Changes made to your account
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="newProducts" checked>
                          <label class="form-check-label" for="newProducts">
                            Information on new products and services
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="proOffers">
                          <label class="form-check-label" for="proOffers">
                            Marketing and promo offers
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="securityNotify" checked disabled>
                          <label class="form-check-label" for="securityNotify">
                            Security alerts
                          </label>
                        </div>
                      </div>
                    </div>

                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                  </form><!-- End settings Form -->

                </div>

                <div class="tab-pane fade pt-3" id="profile-change-password">
                  <!-- Change Password Form -->
                  <form>

                    <div class="row mb-3">
                      <label for="currentPassword" class="col-md-4 col-lg-3 col-form-label">Current Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="password" type="password" class="form-control" id="currentPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="newPassword" class="col-md-4 col-lg-3 col-form-label">New Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="newpassword" type="password" class="form-control" id="newPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="renewPassword" class="col-md-4 col-lg-3 col-form-label">Re-enter New Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="renewpassword" type="password" class="form-control" id="renewPassword">
                      </div>
                    </div>

                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">Change Password</button>
                    </div>
                  </form><!-- End Change Password Form -->

                </div>

              </div><!-- End Bordered Tabs -->

            </div>
          </div>

        </div>
      </div>
    </section>

  </main><!-- End #main -->


  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>NiceAdmin</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      <!-- All the links in the footer should remain intact. -->
      <!-- You can delete the links only if you purchased the pro version. -->
      <!-- Licensing information: https://bootstrapmade.com/license/ -->
      <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
      Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script>
    // let token = window.localStorage.getItem("token");
    // axios.defaults.headers.common["Authorization"] = `Bearer ${token}`;
    var uploadedPhoto;
    const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });
    const form = document.getElementById("guncelle-form");
    const mufettisId = params.mufettisId;
    loadMufettisBilgi();
    function loadMufettisBilgi() {
      axios.get(`https://localhost:7177/api/Mufettis/list-mufettis-by-Id/${mufettisId}`).then(function (response) {

        if (response.data) {
          let mufettis = response.data;
          document.getElementById("isim").innerHTML = mufettis.isim;
          document.getElementById("soyisim").innerHTML = mufettis.soyisim;
          document.getElementById("emailAdress").innerHTML = mufettis.email;
          document.getElementById("tcNo").innerHTML = mufettis.tcNo;
          document.getElementById("sicilNo").innerHTML = mufettis.kurumSicilNo;
          document.getElementById("mufettisNo").innerHTML = mufettis.mufettisNo;
          document.getElementById("unvan").innerHTML = mufettis.unvan;
          document.getElementById("calismaDurumu").innerHTML = mufettis.calismaDurumu;
          document.getElementById("telefon").innerHTML = mufettis.telefon;
          document.getElementById("adres").innerHTML = mufettis.adres;

          document.getElementById("g-isim").value = mufettis.isim;
          document.getElementById("g-soyisim").value = mufettis.soyisim;
          document.getElementById("g-email").value = mufettis.email;
          document.getElementById("g-tcNo").value = mufettis.tcNo;
          document.getElementById("g-kurumSicilNo").value = mufettis.kurumSicilNo;
          document.getElementById("g-mufettisNo").value = mufettis.mufettisNo;
          document.getElementById("g-unvan").value = mufettis.unvan;
          document.getElementById("g-calismaDurumu").value = mufettis.calismaDurumu;
          document.getElementById("g-telefon").value = mufettis.telefon;
          document.getElementById("g-adres").value = mufettis.adres;
          let element = document.getElementById("profile-photo");
          let element2 = document.getElementById("profile-photo-guncelle");
          element.src = mufettis.photo != null ? "data:image/jpeg;base64," + mufettis.photo : element.src;
          element2.src = mufettis.photo != null ? "data:image/jpeg;base64," + mufettis.photo : element2.src;

        } else {
          window.location.href = "/login.html";
        }

      })


    }

    function deleteMufettis() {
      axios
        .delete(`https://localhost:7177/api/Mufettis/delete-mufettis/${mufettisId}`)
        .then((response) => {

          if (response) {

            alert(response.data);
            window.location.href = "/mufettisTanimla.html";

          }

        })
    }



    form.addEventListener("submit", function (event) {
      event.preventDefault();
      let currentMufettis = new FormData();
      currentMufettis.append("Isim", document.getElementById("g-isim").value);
      currentMufettis.append("Soyisim", document.getElementById("g-soyisim").value);
      currentMufettis.append("Email", document.getElementById("g-email").value);
      currentMufettis.append("TcNo", document.getElementById("g-tcNo").value);
      currentMufettis.append("KurumSicilNo", document.getElementById("g-kurumSicilNo").value);
      currentMufettis.append("MufettisNo", document.getElementById("g-mufettisNo").value);
      currentMufettis.append("Unvan", document.getElementById("g-unvan").value);
      currentMufettis.append("CalismaDurumu", document.getElementById("g-calismaDurumu").value);
      currentMufettis.append("Telefon", document.getElementById("g-telefon").value);
      currentMufettis.append("Adres", document.getElementById("g-adres").value);
      currentMufettis.append("Photo", uploadedPhoto);
      axios.put(`https://localhost:7177/api/Mufettis/update-mufettis/${mufettisId}`, currentMufettis, {
        "Content-Type": "multipart/form-data",
      }).then((response) => {

        if (response) {
          alert(response.data);
          loadMufettisBilgi();
        }
      });
    });
    function onUploadPhoto(event) {
      let element = document.getElementById("profile-photo-guncelle");
      element.src = URL.createObjectURL(event.target.files[0]);
      uploadedPhoto = event.target.files[0];
    }

  </script>

</body>

</html>